<div id="cogvis-estimator" class="theme-nhm">
  <style>
    #cogvis-estimator {
      --estimator-font: "Inter", "Segoe UI", sans-serif;
      --estimator-bg: var(--nhm-card, #ffffff);
      --surface: #ffffff;
      --surface-alt: #f3f5f8;
      --surface-emphasis: #e8ecf4;
      --border: var(--nhm-border, #e5e7eb);
      --accent: linear-gradient(135deg, var(--nhm-orange, #f47a00), var(--nhm-orange, #f47a00));
      --accent-strong: var(--nhm-blue, #0c2340);
      --text-primary: var(--nhm-text, #1c1c1c);
      --text-secondary: var(--nhm-blue, #0c2340);
      --text-muted: var(--nhm-blue, #0c2340);
      --text-accent: var(--nhm-blue, #0c2340);
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-sm: 8px;
      font-family: var(--estimator-font);
      color: var(--text-primary);
      background: var(--estimator-bg);
      border-radius: var(--radius-lg);
      padding: 24px;
      display: grid;
      gap: 24px;
      max-width: 1100px;
      margin: 0 auto;
      border: 1px solid rgba(12, 35, 64, 0.1);
      box-shadow: 0 20px 50px rgba(12, 35, 64, 0.08);
      position: relative;
      overflow: hidden;
    }
    #cogvis-estimator::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(12, 35, 64, 0.12), rgba(251, 176, 64, 0.08));
      pointer-events: none;
      mix-blend-mode: multiply;
    }
    #cogvis-estimator > * {
      position: relative;
    }
    #cogvis-estimator * {
      box-sizing: border-box;
    }
    #cogvis-estimator :focus-visible {
      outline: 3px solid rgba(251, 176, 64, 0.6);
      outline-offset: 2px;
    }
    #cogvis-estimator .estimator-layout {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1fr);
      gap: 24px;
    }
    #cogvis-estimator .products {
      display: grid;
      gap: 16px;
    }
    #cogvis-estimator .product-card {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: 24px;
      display: grid;
      grid-template-columns: minmax(140px, 180px) minmax(0, 1fr);
      gap: 20px;
      align-items: center;
      border: 1px solid var(--border);
      box-shadow: 0 10px 25px rgba(12, 35, 64, 0.06);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    #cogvis-estimator .product-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 14px 35px rgba(12, 35, 64, 0.12);
    }
    #cogvis-estimator .product-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: var(--radius-md);
      background: var(--surface-alt);
      border: 1px solid rgba(12, 35, 64, 0.08);
    }
    #cogvis-estimator .product-content {
      display: grid;
      gap: 12px;
      min-width: 0;
    }
    #cogvis-estimator .product-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    #cogvis-estimator .product-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--accent-strong);
    }
    #cogvis-estimator .unit-label {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    #cogvis-estimator .price-display {
      font-size: 1.05rem;
      font-weight: 600;
      color: var(--text-accent);
    }
    #cogvis-estimator .stepper {
      display: inline-flex;
      align-items: center;
      border: 1px solid rgba(12, 35, 64, 0.14);
      border-radius: var(--radius-md);
      overflow: hidden;
      width: fit-content;
      background: var(--surface-alt);
    }
    #cogvis-estimator .stepper button {
      background: transparent;
      border: none;
      color: var(--accent-strong);
      width: 40px;
      height: 40px;
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: background 0.2s ease;
      font-size: 1.2rem;
      line-height: 1;
    }
    #cogvis-estimator .stepper button:hover {
      background: var(--surface-emphasis);
    }
    #cogvis-estimator .stepper input {
      width: 70px;
      text-align: center;
      border: none;
      background: transparent;
      color: var(--text-primary);
      font-size: 1rem;
      padding: 0;
      -moz-appearance: textfield;
    }
    #cogvis-estimator .stepper input::-webkit-outer-spin-button,
    #cogvis-estimator .stepper input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    #cogvis-estimator .summary-card {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: 24px;
      display: grid;
      gap: 16px;
      align-self: start;
      border: 1px solid var(--border);
      box-shadow: 0 12px 30px rgba(12, 35, 64, 0.08);
    }
    #cogvis-estimator .summary-card h2 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent-strong);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    #cogvis-estimator .summary-card h2::before {
      content: "";
      width: 36px;
      height: 4px;
      border-radius: 999px;
      background: var(--accent);
    }
    #cogvis-estimator .tier-selector {
      display: grid;
      gap: 8px;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    }
    #cogvis-estimator .tier-selector button {
      border: 1px solid rgba(12, 35, 64, 0.18);
      border-radius: var(--radius-md);
      padding: 10px 12px;
      background: var(--surface-alt);
      color: var(--text-secondary);
      font-weight: 600;
      font-size: 0.85rem;
      display: grid;
      gap: 4px;
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease, color 0.2s ease;
    }
    #cogvis-estimator .tier-selector button small {
      font-weight: 500;
      font-size: 0.7rem;
      opacity: 0.8;
    }
    #cogvis-estimator .tier-selector button.is-active {
      background: var(--accent);
      border-color: rgba(251, 176, 64, 0.55);
      color: #0c2340;
      box-shadow: 0 10px 25px rgba(251, 176, 64, 0.28);
    }
    #cogvis-estimator .summary-list {
      display: grid;
      gap: 12px;
    }
    #cogvis-estimator .summary-line {
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
      color: var(--nhm-blue, #0c2340);
      gap: 12px;
    }
    #cogvis-estimator .summary-line .label {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    #cogvis-estimator .summary-line .label span {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }
    #cogvis-estimator .summary-line strong {
      font-weight: 600;
      white-space: nowrap;
    }
    #cogvis-estimator .total-line {
      border-top: 1px solid var(--border);
      padding-top: 12px;
      font-size: 1.05rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    #cogvis-estimator .vat-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
      color: var(--text-secondary);
    }
    #cogvis-estimator .vat-toggle input {
      width: 18px;
      height: 18px;
    }
    #cogvis-estimator .actions {
      display: grid;
      gap: 10px;
    }
    #cogvis-estimator .actions a {
      text-decoration: none;
      text-align: center;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      font-weight: 600;
      transition: transform 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
    }
    #cogvis-estimator .actions a.primary {
      background: var(--accent);
      color: #0c2340;
      box-shadow: 0 10px 25px rgba(251, 176, 64, 0.3);
    }
    #cogvis-estimator .actions a.secondary {
      background: transparent;
      color: var(--accent-strong);
      border: 1px solid rgba(12, 35, 64, 0.25);
    }
    #cogvis-estimator .actions a:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 28px rgba(12, 35, 64, 0.14);
    }
    #cogvis-estimator .disclaimer {
      font-size: 0.75rem;
      color: var(--text-muted);
      line-height: 1.4;
    }
    #cogvis-estimator .tier-indicator {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }
    #cogvis-estimator .product-helper {
      font-size: 0.78rem;
      color: rgba(12, 35, 64, 0.75);
    }
    #cogvis-estimator .product-helper strong {
      font-weight: 600;
      color: var(--accent-strong);
    }
    #cogvis-estimator .stepper button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    #cogvis-estimator .stepper input[readonly] {
      cursor: default;
      color: var(--text-secondary);
    }
    @media (max-width: 900px) {
      #cogvis-estimator {
        padding: 20px;
      }
      #cogvis-estimator .estimator-layout {
        grid-template-columns: 1fr;
      }
      #cogvis-estimator .product-card {
        grid-template-columns: 1fr;
      }
      #cogvis-estimator .product-card img {
        height: 200px;
      }
      #cogvis-estimator .summary-card {
        position: sticky;
        top: 16px;
      }
    }
  </style>
  <div class="estimator-layout">
    <div class="products">
      <div class="product-card" data-product-id="sensor">
        <img data-sensor-image src="Picture6.png" alt="Cogvis fall detection sensor" loading="lazy" decoding="async">
        <div class="product-content">
          <div class="product-header">
            <div class="product-name">Sensor (standard variants)</div>
            <div class="unit-label">Per sensor</div>
            <div class="price-display" data-price-display></div>
          </div>
          <div class="stepper" role="group" aria-label="Sensor quantity selector">
            <button type="button" class="decrement" aria-label="Decrease sensor quantity">-</button>
            <input type="number" inputmode="numeric" min="0" step="1" value="0" aria-label="Sensor quantity input">
            <button type="button" class="increment" aria-label="Increase sensor quantity">+</button>
          </div>
        </div>
      </div>
      <div class="product-card" data-product-id="docker">
        <img src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20320%20220%22%3E%0A%20%20%3Cdefs%3E%0A%20%20%20%20%3ClinearGradient%20id%3D%22panel%22%20x1%3D%220%22%20y1%3D%220%22%20x2%3D%221%22%20y2%3D%221%22%3E%0A%20%20%20%20%20%20%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%230c2340%22%20stop-opacity%3D%220.08%22%20/%3E%0A%20%20%20%20%20%20%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%23fbb040%22%20stop-opacity%3D%220.12%22%20/%3E%0A%20%20%20%20%3C/linearGradient%3E%0A%20%20%3C/defs%3E%0A%20%20%3Crect%20width%3D%22320%22%20height%3D%22220%22%20rx%3D%2224%22%20fill%3D%22%23f5f7fb%22%20/%3E%0A%20%20%3Crect%20x%3D%2228%22%20y%3D%2236%22%20width%3D%22264%22%20height%3D%22148%22%20rx%3D%2220%22%20fill%3D%22url%28%23panel%29%22%20stroke%3D%22%239db4d5%22%20stroke-width%3D%224%22%20/%3E%0A%20%20%3Cg%20fill%3D%22%230c2340%22%20opacity%3D%220.8%22%3E%0A%20%20%20%20%3Crect%20x%3D%2264%22%20y%3D%2270%22%20width%3D%2256%22%20height%3D%2280%22%20rx%3D%2210%22%20fill%3D%22%23ffffff%22%20stroke%3D%22%230c2340%22%20stroke-width%3D%224%22%20/%3E%0A%20%20%20%20%3Ccircle%20cx%3D%2292%22%20cy%3D%2298%22%20r%3D%2212%22%20fill%3D%22%23fbb040%22%20/%3E%0A%20%20%20%20%3Crect%20x%3D%22100%22%20y%3D%22124%22%20width%3D%2212%22%20height%3D%2218%22%20rx%3D%224%22%20fill%3D%22%230c2340%22%20/%3E%0A%20%20%3C/g%3E%0A%20%20%3Cg%20fill%3D%22%230c2340%22%20opacity%3D%220.7%22%3E%0A%20%20%20%20%3Crect%20x%3D%22136%22%20y%3D%2270%22%20width%3D%2256%22%20height%3D%2280%22%20rx%3D%2210%22%20fill%3D%22%23ffffff%22%20stroke%3D%22%230c2340%22%20stroke-width%3D%224%22%20/%3E%0A%20%20%20%20%3Ccircle%20cx%3D%22164%22%20cy%3D%2298%22%20r%3D%2212%22%20fill%3D%22%237dc2ff%22%20/%3E%0A%20%20%20%20%3Crect%20x%3D%22172%22%20y%3D%22124%22%20width%3D%2212%22%20height%3D%2218%22%20rx%3D%224%22%20fill%3D%22%230c2340%22%20/%3E%0A%20%20%3C/g%3E%0A%20%20%3Cg%20fill%3D%22%230c2340%22%20opacity%3D%220.6%22%3E%0A%20%20%20%20%3Crect%20x%3D%22208%22%20y%3D%2270%22%20width%3D%2256%22%20height%3D%2280%22%20rx%3D%2210%22%20fill%3D%22%23ffffff%22%20stroke%3D%22%230c2340%22%20stroke-width%3D%224%22%20/%3E%0A%20%20%20%20%3Ccircle%20cx%3D%22236%22%20cy%3D%2298%22%20r%3D%2212%22%20fill%3D%22%23fbb040%22%20/%3E%0A%20%20%20%20%3Crect%20x%3D%22244%22%20y%3D%22124%22%20width%3D%2212%22%20height%3D%2218%22%20rx%3D%224%22%20fill%3D%22%230c2340%22%20/%3E%0A%20%20%3C/g%3E%0A%20%20%3Cpath%20d%3D%22M64%20164h200%22%20stroke%3D%22%230c2340%22%20stroke-width%3D%226%22%20stroke-linecap%3D%22round%22%20stroke-dasharray%3D%2216%2018%22%20opacity%3D%220.5%22%20/%3E%0A%3C/svg%3E" alt="Sensor docking station illustration">
        <div class="product-content">
          <div class="product-header">
            <div class="product-name">Sensor Docker</div>
            <div class="unit-label">Per docking station</div>
            <div class="price-display" data-price-display></div>
          </div>
          <div class="stepper" role="group" aria-label="Sensor Docker quantity selector">
            <button type="button" class="decrement" aria-label="Decrease Sensor Docker quantity">-</button>
            <input type="number" inputmode="numeric" min="0" step="1" value="0" aria-label="Sensor Docker quantity input">
            <button type="button" class="increment" aria-label="Increase Sensor Docker quantity">+</button>
          </div>
          <div class="product-helper" data-docker-helper>Recommended: 0 docking stations</div>
        </div>
      </div>
      <div class="product-card" data-product-id="software">
        <img src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20320%20220%22%3E%0A%20%20%3Cdefs%3E%0A%20%20%20%20%3ClinearGradient%20id%3D%22screen%22%20x1%3D%220%22%20y1%3D%220%22%20x2%3D%221%22%20y2%3D%221%22%3E%0A%20%20%20%20%20%20%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%237dc2ff%22%20stop-opacity%3D%220.18%22%20/%3E%0A%20%20%20%20%20%20%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%23fbb040%22%20stop-opacity%3D%220.18%22%20/%3E%0A%20%20%20%20%3C/linearGradient%3E%0A%20%20%3C/defs%3E%0A%20%20%3Crect%20width%3D%22320%22%20height%3D%22220%22%20rx%3D%2224%22%20fill%3D%22%23f6f8fb%22%20/%3E%0A%20%20%3Crect%20x%3D%2236%22%20y%3D%2242%22%20width%3D%22248%22%20height%3D%22150%22%20rx%3D%2218%22%20fill%3D%22%23ffffff%22%20stroke%3D%22%23c7d6ec%22%20stroke-width%3D%224%22%20/%3E%0A%20%20%3Crect%20x%3D%2252%22%20y%3D%2258%22%20width%3D%22216%22%20height%3D%22118%22%20rx%3D%2214%22%20fill%3D%22url%28%23screen%29%22%20/%3E%0A%20%20%3Cg%20stroke%3D%22%230c2340%22%20stroke-width%3D%226%22%20stroke-linecap%3D%22round%22%20fill%3D%22none%22%3E%0A%20%20%20%20%3Cpath%20d%3D%22M76%20136c24-30%2046-30%2070%200%2024%2030%2048%2030%2072%200%22%20opacity%3D%220.7%22%20/%3E%0A%20%20%20%20%3Cpath%20d%3D%22M108%20112c12-16%2024-16%2036%200%2012%2016%2024%2016%2036%200%22%20opacity%3D%220.55%22%20/%3E%0A%20%20%3C/g%3E%0A%20%20%3Ccircle%20cx%3D%22116%22%20cy%3D%2296%22%20r%3D%2210%22%20fill%3D%22%230c2340%22%20opacity%3D%220.75%22%20/%3E%0A%20%20%3Ccircle%20cx%3D%22160%22%20cy%3D%2296%22%20r%3D%2210%22%20fill%3D%22%23fbb040%22%20opacity%3D%220.8%22%20/%3E%0A%20%20%3Ccircle%20cx%3D%22204%22%20cy%3D%2296%22%20r%3D%2210%22%20fill%3D%22%230c2340%22%20opacity%3D%220.6%22%20/%3E%0A%20%20%3Cpath%20d%3D%22M104%20180h112%22%20stroke%3D%22%230c2340%22%20stroke-width%3D%228%22%20stroke-linecap%3D%22round%22%20opacity%3D%220.35%22%20/%3E%0A%3C/svg%3E" alt="Nursing home software illustration">
        <div class="product-content">
          <div class="product-header">
            <div class="product-name">Nursing Home Software (1 Year)</div>
            <div class="unit-label">Per sensor licence</div>
            <div class="price-display" data-price-display></div>
          </div>
          <div class="stepper" role="group" aria-label="Nursing Home Software quantity selector">
            <button type="button" class="decrement" aria-label="Decrease Nursing Home Software quantity">-</button>
            <input type="number" inputmode="numeric" min="0" step="1" value="0" aria-label="Nursing Home Software quantity input" readonly>
            <button type="button" class="increment" aria-label="Increase Nursing Home Software quantity">+</button>
          </div>
        </div>
      </div>
    </div>
    <div class="summary-card">
      <h2>Quick Price Estimator</h2>
      <div class="tier-selector" data-tier-selector role="group" aria-label="Pricing tier selection">
        <button type="button" data-tier-button="tier1">
          <span>Tier 1</span>
          <small>1-4 sensors</small>
        </button>
        <button type="button" data-tier-button="tier2">
          <span>Tier 2</span>
          <small>5-10 sensors</small>
        </button>
        <button type="button" data-tier-button="tier3">
          <span>Tier 3</span>
          <small>11-19 sensors</small>
        </button>
        <button type="button" data-tier-button="tier4">
          <span>Tier 4</span>
          <small>20+ sensors</small>
        </button>
      </div>
      <div class="tier-indicator" data-tier-indicator></div>
      <label class="vat-toggle">
        <input type="checkbox" id="vat-toggle" checked>
        <span>Include VAT (20%)</span>
      </label>
      <div class="summary-list" id="summary-lines"></div>
      <div class="summary-line" data-summary-subtotal>
        <div class="label">Subtotal</div>
        <strong></strong>
      </div>
      <div class="summary-line" data-summary-vat style="display: none;">
        <div class="label">VAT (20%)</div>
        <strong></strong>
      </div>
      <div class="summary-line total-line" data-summary-total>
        <div class="label">Estimated total</div>
        <strong></strong>
      </div>
      <div class="actions">
        <a class="primary" data-booking-link href="#">Book a site survey</a>
        <a class="secondary" data-email-link href="#">Email me this estimate</a>
      </div>
      <div class="disclaimer">Estimates are for guidance only and subject to site survey. Docking station quantities may vary by layout and power availability.</div>
    </div>
  </div>
  <script src="sensor-image.js"></script>
  <script>
    (function () {
      const script = document.currentScript;
      const root = script ? script.closest('#cogvis-estimator') : document.getElementById('cogvis-estimator');
      if (!root) return;

      const BOOKING_URL = 'https://example.com/book';
      const VAT_RATE = 0.2;
      const MAX_SENSORS = 200;
      const MAX_DOCKERS = 450;
      const DOCKERS_PER_SENSOR = 2.5;

      const products = [
        { id: 'sensor', name: 'Sensor (standard variants)', unitLabel: 'Per sensor' },
        { id: 'docker', name: 'Sensor Docker', unitLabel: 'Per docking station' },
        { id: 'software', name: 'Nursing Home Software (1 Year)', unitLabel: 'Per sensor licence' }
      ];

      const tiers = [
        { id: 'tier1', label: 'Tier 1', range: '1-4 sensors', min: 1, max: 4, prices: { sensor: 1365, docker: 419, software: 475 } },
        { id: 'tier2', label: 'Tier 2', range: '5-10 sensors', min: 5, max: 10, prices: { sensor: 1295, docker: 379, software: 439 } },
        { id: 'tier3', label: 'Tier 3', range: '11-19 sensors', min: 11, max: 19, prices: { sensor: 1245, docker: 359, software: 419 } },
        { id: 'tier4', label: 'Tier 4', range: '20+ sensors', min: 20, max: Infinity, prices: { sensor: 1195, docker: 339, software: 399 } }
      ];

      const state = { sensor: tiers[0].min, docker: 0, software: 0 };
      let selectedTierId = tiers[0].id;

      const productCards = root.querySelectorAll('.product-card');
      const summaryLinesContainer = root.querySelector('#summary-lines');
      const tierIndicator = root.querySelector('[data-tier-indicator]');
      const subtotalEl = root.querySelector('[data-summary-subtotal] strong');
      const vatRow = root.querySelector('[data-summary-vat]');
      const vatValueEl = vatRow.querySelector('strong');
      const totalEl = root.querySelector('[data-summary-total] strong');
      const vatToggle = root.querySelector('#vat-toggle');
      const bookingLink = root.querySelector('[data-booking-link]');
      const emailLink = root.querySelector('[data-email-link]');
      const tierSelector = root.querySelector('[data-tier-selector]');
      const tierButtons = tierSelector ? Array.from(tierSelector.querySelectorAll('[data-tier-button]')) : [];
      const dockerHelper = root.querySelector('[data-docker-helper]');

      let sensorInput = null;
      let dockerInput = null;
      let softwareInput = null;

      function money(value) {
        return new Intl.NumberFormat('en-GB', {
          style: 'currency',
          currency: 'GBP',
          minimumFractionDigits: 2
        }).format(value);
      }

      function tierDisplayName(tier) {
        return `${tier.label} (${tier.range})`;
      }

      function findTierById(id) {
        return tiers.find(tier => tier.id === id);
      }

      function tierForSensorCount(totalSensors) {
        if (totalSensors <= 0) {
          return tiers[0];
        }
        return tiers.find(tier => totalSensors >= tier.min && totalSensors <= tier.max) || tiers[tiers.length - 1];
      }

      function resolveTier(totalSensors) {
        return findTierById(selectedTierId) || tierForSensorCount(totalSensors);
      }

      function clampQuantity(value, max) {
        const numeric = Number(value);
        if (!Number.isFinite(numeric) || numeric < 0) {
          return 0;
        }
        return Math.min(Math.round(numeric), max);
      }

      function recommendedDockersFor(sensorCount) {
        if (sensorCount <= 0) {
          return 0;
        }
        return Math.min(MAX_DOCKERS, Math.ceil(sensorCount * DOCKERS_PER_SENSOR));
      }

      function updateDockerHelperText(recommended) {
        if (!dockerHelper) return;
        if (state.sensor <= 0) {
          dockerHelper.textContent = 'Recommended: 0 docking stations';
          return;
        }
        const suffix = recommended === 1 ? '' : 's';
        dockerHelper.innerHTML = `Recommended: <strong>${recommended}</strong> docking station${suffix} (1 sensor : 2.5 docking stations)`;
      }

      function handleSensorDependencies() {
        const recommended = recommendedDockersFor(state.sensor);
        if (dockerInput) {
          state.docker = Math.min(Math.max(recommended, state.sensor), MAX_DOCKERS);
          dockerInput.value = state.docker;
        }
        if (softwareInput) {
          state.software = state.sensor;
          softwareInput.value = state.software;
        }
        updateDockerHelperText(recommended);
      }

      function adjustSensorsForTier(tier) {
        if (!tier) return;
        const maxForTier = Number.isFinite(tier.max) ? tier.max : MAX_SENSORS;
        const adjusted = Math.min(Math.max(tier.min, 0), maxForTier);
        if (adjusted !== state.sensor) {
          state.sensor = adjusted;
          if (sensorInput) {
            sensorInput.value = state.sensor;
          }
        }
        handleSensorDependencies();
      }

      function getUnitPrice(productId, tier) {
        return tier.prices[productId] || 0;
      }

      function buildSummaryLine(product, quantity, unitPrice) {
        const lineTotal = quantity * unitPrice;
        const line = document.createElement('div');
        line.className = 'summary-line';
        line.innerHTML = `
          <div class="label">
            ${product.name}
            <span>${quantity} &times; ${money(unitPrice)}</span>
          </div>
          <strong>${money(lineTotal)}</strong>
        `;
        return line;
      }

      function updateSummary(tier) {
        summaryLinesContainer.innerHTML = '';
        products.forEach(product => {
          const qty = state[product.id];
          const unitPrice = getUnitPrice(product.id, tier);
          summaryLinesContainer.appendChild(buildSummaryLine(product, qty, unitPrice));
        });
      }

      function syncTierButtons(tier) {
        tierButtons.forEach(button => {
          const target = button.getAttribute('data-tier-button');
          button.classList.toggle('is-active', tier ? target === tier.id : false);
        });
        if (tierIndicator && tier) {
          tierIndicator.textContent = `Selected tier: ${tierDisplayName(tier)}`;
        }
      }

      function updatePricing() {
        const totalSensors = state.sensor;
        const tier = resolveTier(totalSensors);
        syncTierButtons(tier);

        productCards.forEach(card => {
          const productId = card.getAttribute('data-product-id');
          const display = card.querySelector('[data-price-display]');
          if (display) {
            display.textContent = money(getUnitPrice(productId, tier));
          }
        });

        updateSummary(tier);

        const subtotal = products.reduce((sum, product) => {
          const unitPrice = getUnitPrice(product.id, tier);
          return sum + state[product.id] * unitPrice;
        }, 0);

        const vatIncluded = vatToggle.checked;
        const vatAmount = vatIncluded ? subtotal * VAT_RATE : 0;
        const total = subtotal + vatAmount;

        subtotalEl.textContent = money(subtotal);
        if (vatIncluded) {
          vatRow.style.display = 'flex';
          vatValueEl.textContent = money(vatAmount);
        } else {
          vatRow.style.display = 'none';
          vatValueEl.textContent = money(0);
        }
        totalEl.textContent = money(total);

        const itemsParam = `sensor:${state.sensor},docker:${state.docker},software:${state.software}`;
        const vatParam = vatIncluded ? '1' : '0';
        bookingLink.href = `${BOOKING_URL}?vat=${vatParam}&items=${encodeURIComponent(itemsParam)}`;

        const emailSubject = encodeURIComponent('Cogvis AI â€“ Quick Price Estimate');
        const bodyLines = [
          `Tier: ${tierDisplayName(tier)}`,
          `VAT included: ${vatIncluded ? 'Yes' : 'No'}`,
          '',
          ...products.map(product => {
            const unitPrice = getUnitPrice(product.id, tier);
            const qty = state[product.id];
            const lineTotal = qty * unitPrice;
            return `${product.name}: ${qty} x ${money(unitPrice)} = ${money(lineTotal)}`;
          }),
          '',
          `Subtotal: ${money(subtotal)}`
        ];
        if (vatIncluded) {
          bodyLines.push(`VAT (20%): ${money(vatAmount)}`);
        }
        bodyLines.push(`Estimated total: ${money(total)}`);
        const emailBody = encodeURIComponent(bodyLines.join('\n'));
        emailLink.href = `mailto:?subject=${emailSubject}&body=${emailBody}`;
      }

      if (tierButtons.length) {
        tierButtons.forEach(button => {
          button.addEventListener('click', () => {
            const target = button.getAttribute('data-tier-button');
            const tier = findTierById(target);
            if (!tier) {
              return;
            }
            selectedTierId = tier.id;
            adjustSensorsForTier(tier);
            updatePricing();
          });
        });
      }

      productCards.forEach(card => {
        const productId = card.getAttribute('data-product-id');
        const input = card.querySelector('input[type="number"]');
        const decrement = card.querySelector('.decrement');
        const increment = card.querySelector('.increment');
        if (!input || !decrement || !increment) {
          return;
        }

        if (productId === 'docker') {
          dockerInput = input;
        } else if (productId === 'software') {
          softwareInput = input;
          input.readOnly = true;
          input.setAttribute('aria-readonly', 'true');
          decrement.disabled = true;
          increment.disabled = true;
        }

        const filterNumericInput = () => {
          const cleaned = input.value.replace(/[^0-9]/g, '');
          if (cleaned !== input.value) {
            input.value = cleaned;
          }
        };

        if (productId === 'sensor') {
          sensorInput = input;
          input.value = state.sensor;
          const sync = () => {
            state.sensor = clampQuantity(input.value, MAX_SENSORS);
            input.value = state.sensor;
            handleSensorDependencies();
            const tier = tierForSensorCount(state.sensor);
            if (tier) {
              selectedTierId = tier.id;
            }
            updatePricing();
          };

          decrement.addEventListener('click', () => {
            input.value = clampQuantity(Number(input.value) - 1, MAX_SENSORS);
            sync();
          });

          increment.addEventListener('click', () => {
            input.value = clampQuantity(Number(input.value) + 1, MAX_SENSORS);
            sync();
          });

          input.addEventListener('change', sync);
          input.addEventListener('input', filterNumericInput);
        } else if (productId === 'docker') {
          const sync = () => {
            const clamped = clampQuantity(input.value, MAX_DOCKERS);
            state.docker = Math.min(Math.max(clamped, state.sensor), MAX_DOCKERS);
            input.value = state.docker;
            updateDockerHelperText(recommendedDockersFor(state.sensor));
            updatePricing();
          };

          decrement.addEventListener('click', () => {
            input.value = clampQuantity(Number(input.value) - 1, MAX_DOCKERS);
            sync();
          });

          increment.addEventListener('click', () => {
            input.value = clampQuantity(Number(input.value) + 1, MAX_DOCKERS);
            sync();
          });

          input.addEventListener('change', sync);
          input.addEventListener('input', filterNumericInput);
        } else if (productId === 'software') {
          input.addEventListener('input', filterNumericInput);
        }
      });

      vatToggle.addEventListener('change', updatePricing);

      handleSensorDependencies();
      updatePricing();
    })();
  </script>
</div>
