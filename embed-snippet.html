<div id="cogvis-estimator">
  <style>
    #cogvis-estimator {
      font-family: "Inter", "Segoe UI", sans-serif;
      color: #f8f9fb;
      background: #10131a;
      border-radius: 20px;
      padding: 24px;
      display: grid;
      gap: 24px;
    }
    #cogvis-estimator * {
      box-sizing: border-box;
    }
    #cogvis-estimator :focus-visible {
      outline: 2px solid #5ddcff;
      outline-offset: 2px;
    }
    #cogvis-estimator .estimator-layout {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 24px;
    }
    #cogvis-estimator .products {
      display: grid;
      gap: 16px;
    }
    #cogvis-estimator .product-card {
      background: #161b26;
      border-radius: 16px;
      padding: 20px;
      display: grid;
      grid-template-columns: minmax(140px, 180px) 1fr;
      gap: 20px;
      align-items: center;
    }
    #cogvis-estimator .product-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
      background: #0e1118;
    }
    #cogvis-estimator .product-content {
      display: grid;
      gap: 12px;
    }
    #cogvis-estimator .product-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    #cogvis-estimator .product-name {
      font-size: 1.1rem;
      font-weight: 600;
    }
    #cogvis-estimator .unit-label {
      color: #9aa3b9;
      font-size: 0.9rem;
    }
    #cogvis-estimator .price-display {
      font-size: 1.05rem;
      font-weight: 600;
      color: #5ddcff;
    }
    #cogvis-estimator .stepper {
      display: inline-flex;
      align-items: center;
      border: 1px solid #2a3242;
      border-radius: 12px;
      overflow: hidden;
      width: fit-content;
      background: #0f121b;
    }
    #cogvis-estimator .stepper button {
      background: transparent;
      border: none;
      color: #f8f9fb;
      width: 40px;
      height: 40px;
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    #cogvis-estimator .stepper button:hover {
      background: #1f2533;
    }
    #cogvis-estimator .stepper input {
      width: 64px;
      text-align: center;
      border: none;
      background: transparent;
      color: #f8f9fb;
      font-size: 1rem;
      padding: 0;
      -moz-appearance: textfield;
    }
    #cogvis-estimator .stepper input::-webkit-outer-spin-button,
    #cogvis-estimator .stepper input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    #cogvis-estimator .summary-card {
      background: #161b26;
      border-radius: 16px;
      padding: 20px;
      display: grid;
      gap: 16px;
      align-self: start;
    }
    #cogvis-estimator .summary-card h2 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 600;
    }
    #cogvis-estimator .summary-list {
      display: grid;
      gap: 12px;
    }
    #cogvis-estimator .summary-line {
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
      color: #d7deed;
    }
    #cogvis-estimator .summary-line .label {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    #cogvis-estimator .summary-line .label span {
      font-size: 0.8rem;
      color: #9aa3b9;
    }
    #cogvis-estimator .summary-line strong {
      font-weight: 600;
    }
    #cogvis-estimator .total-line {
      border-top: 1px solid #2a3242;
      padding-top: 12px;
      font-size: 1.05rem;
      font-weight: 600;
      color: #f8f9fb;
    }
    #cogvis-estimator .vat-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
    }
    #cogvis-estimator .actions {
      display: grid;
      gap: 10px;
    }
    #cogvis-estimator .actions a {
      text-decoration: none;
      text-align: center;
      padding: 12px 16px;
      border-radius: 12px;
      font-weight: 600;
      transition: transform 0.2s ease, background 0.2s ease;
    }
    #cogvis-estimator .actions a.primary {
      background: linear-gradient(135deg, #5ddcff, #8a6dff);
      color: #0b101a;
    }
    #cogvis-estimator .actions a.secondary {
      background: #0f121b;
      color: #f8f9fb;
      border: 1px solid #2a3242;
    }
    #cogvis-estimator .actions a:hover {
      transform: translateY(-1px);
    }
    #cogvis-estimator .disclaimer {
      font-size: 0.75rem;
      color: #7f8aa8;
      line-height: 1.4;
    }
    #cogvis-estimator .tier-indicator {
      font-size: 0.85rem;
      color: #9aa3b9;
    }
    @media (max-width: 900px) {
      #cogvis-estimator .estimator-layout {
        grid-template-columns: 1fr;
      }
      #cogvis-estimator .product-card {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <div class="estimator-layout">
    <div class="products">
      <div class="product-card" data-product-id="sensor">
        <img src="https://placehold.co/600x400?text=Sensor" alt="Sensor placeholder image">
        <div class="product-content">
          <div class="product-header">
            <div class="product-name">Sensor (standard variants)</div>
            <div class="unit-label">Per sensor</div>
            <div class="price-display" data-price-display></div>
          </div>
          <div class="stepper" role="group" aria-label="Sensor quantity selector">
            <button type="button" class="decrement" aria-label="Decrease sensor quantity">−</button>
            <input type="number" inputmode="numeric" min="0" step="1" value="0" aria-label="Sensor quantity input">
            <button type="button" class="increment" aria-label="Increase sensor quantity">+</button>
          </div>
        </div>
      </div>
      <div class="product-card" data-product-id="docker">
        <img src="https://placehold.co/600x400?text=Sensor+Docker" alt="Sensor Docker placeholder image">
        <div class="product-content">
          <div class="product-header">
            <div class="product-name">Sensor Docker</div>
            <div class="unit-label">Per docking station</div>
            <div class="price-display" data-price-display></div>
          </div>
          <div class="stepper" role="group" aria-label="Sensor Docker quantity selector">
            <button type="button" class="decrement" aria-label="Decrease Sensor Docker quantity">−</button>
            <input type="number" inputmode="numeric" min="0" step="1" value="0" aria-label="Sensor Docker quantity input">
            <button type="button" class="increment" aria-label="Increase Sensor Docker quantity">+</button>
          </div>
        </div>
      </div>
      <div class="product-card" data-product-id="software">
        <img src="https://placehold.co/600x400?text=Nursing+Home+Software" alt="Nursing Home Software placeholder image">
        <div class="product-content">
          <div class="product-header">
            <div class="product-name">Nursing Home Software (1 Year)</div>
            <div class="unit-label">Per site licence</div>
            <div class="price-display" data-price-display></div>
          </div>
          <div class="stepper" role="group" aria-label="Nursing Home Software quantity selector">
            <button type="button" class="decrement" aria-label="Decrease Nursing Home Software quantity">−</button>
            <input type="number" inputmode="numeric" min="0" step="1" value="0" aria-label="Nursing Home Software quantity input">
            <button type="button" class="increment" aria-label="Increase Nursing Home Software quantity">+</button>
          </div>
        </div>
      </div>
    </div>
    <div class="summary-card">
      <h2>Quick Price Estimator</h2>
      <div class="tier-indicator" data-tier-indicator></div>
      <label class="vat-toggle">
        <input type="checkbox" id="vat-toggle" checked>
        <span>Include VAT (20%)</span>
      </label>
      <div class="summary-list" id="summary-lines"></div>
      <div class="summary-line" data-summary-subtotal>
        <div class="label">Subtotal</div>
        <strong></strong>
      </div>
      <div class="summary-line" data-summary-vat style="display: none;">
        <div class="label">VAT (20%)</div>
        <strong></strong>
      </div>
      <div class="summary-line total-line" data-summary-total>
        <div class="label">Estimated total</div>
        <strong></strong>
      </div>
      <div class="actions">
        <a class="primary" data-booking-link href="#">Book a site survey</a>
        <a class="secondary" data-email-link href="#">Email me this estimate</a>
      </div>
      <div class="disclaimer">Estimates are for guidance only and subject to site survey. Docking station quantities may vary by layout and power availability.</div>
    </div>
  </div>
  <script>
    (function () {
      const BOOKING_URL = 'https://example.com/book';
      const VAT_RATE = 0.2;
      const products = [
        {
          id: 'sensor',
          name: 'Sensor (standard variants)',
          unitLabel: 'Per sensor'
        },
        {
          id: 'docker',
          name: 'Sensor Docker',
          unitLabel: 'Per docking station'
        },
        {
          id: 'software',
          name: 'Nursing Home Software (1 Year)',
          unitLabel: 'Per site licence'
        }
      ];

      const tiers = [
        { id: 'tier1', name: 'Tier 1 · 1–3 sensors', min: 1, max: 3, prices: { sensor: 1295, docker: 379, software: 439 } },
        { id: 'tier2', name: 'Tier 2 · 4–9 sensors', min: 4, max: 9, prices: { sensor: 1245, docker: 359, software: 419 } },
        { id: 'tier3', name: 'Tier 3 · 10+ sensors', min: 10, max: Infinity, prices: { sensor: 1095, docker: 339, software: 399 } }
      ];

      const quantityState = {
        sensor: 0,
        docker: 0,
        software: 0
      };

      const productCards = document.querySelectorAll('#cogvis-estimator .product-card');
      const summaryLinesContainer = document.getElementById('summary-lines');
      const tierIndicator = document.querySelector('[data-tier-indicator]');
      const subtotalEl = document.querySelector('[data-summary-subtotal] strong');
      const vatRow = document.querySelector('[data-summary-vat]');
      const vatValueEl = vatRow.querySelector('strong');
      const totalEl = document.querySelector('[data-summary-total] strong');
      const vatToggle = document.getElementById('vat-toggle');
      const bookingLink = document.querySelector('[data-booking-link]');
      const emailLink = document.querySelector('[data-email-link]');

      function money(value) {
        return new Intl.NumberFormat('en-GB', {
          style: 'currency',
          currency: 'GBP',
          minimumFractionDigits: 2
        }).format(value);
      }

      function currentTier(totalSensors) {
        if (totalSensors === 0) {
          return tiers[0];
        }
        return tiers.find(tier => totalSensors >= tier.min && totalSensors <= tier.max) || tiers[tiers.length - 1];
      }

      function getUnitPrice(productId, tier) {
        return tier.prices[productId] || 0;
      }

      function renderSummary(tier) {
        summaryLinesContainer.innerHTML = '';
        products.forEach(product => {
          const qty = quantityState[product.id];
          const unitPrice = getUnitPrice(product.id, tier);
          const lineTotal = qty * unitPrice;
          const line = document.createElement('div');
          line.className = 'summary-line';
          line.innerHTML = `
            <div class="label">
              ${product.name}
              <span>${qty} × ${money(unitPrice)}</span>
            </div>
            <strong>${money(lineTotal)}</strong>
          `;
          summaryLinesContainer.appendChild(line);
        });
      }

      function updatePrices() {
        const totalSensors = quantityState.sensor;
        const tier = currentTier(totalSensors);
        tierIndicator.textContent = `${tier.name}`;

        productCards.forEach(card => {
          const productId = card.getAttribute('data-product-id');
          const display = card.querySelector('[data-price-display]');
          display.textContent = money(getUnitPrice(productId, tier));
        });

        renderSummary(tier);

        const subtotal = products.reduce((sum, product) => {
          const unitPrice = getUnitPrice(product.id, tier);
          return sum + quantityState[product.id] * unitPrice;
        }, 0);

        const vatIncluded = vatToggle.checked;
        const vatAmount = vatIncluded ? subtotal * VAT_RATE : 0;
        const total = subtotal + vatAmount;

        subtotalEl.textContent = money(subtotal);
        if (vatIncluded) {
          vatRow.style.display = 'flex';
          vatValueEl.textContent = money(vatAmount);
        } else {
          vatRow.style.display = 'none';
          vatValueEl.textContent = money(0);
        }
        totalEl.textContent = money(total);

        const itemsParam = `sensor:${quantityState.sensor},docker:${quantityState.docker},software:${quantityState.software}`;
        const vatParam = vatIncluded ? '1' : '0';
        bookingLink.href = `${BOOKING_URL}?vat=${vatParam}&items=${encodeURIComponent(itemsParam)}`;

        const emailSubject = encodeURIComponent('Cogvis AI – Quick Price Estimate');
        const bodyLines = [
          `Tier: ${tier.name}`,
          `VAT included: ${vatIncluded ? 'Yes' : 'No'}`,
          '',
          ...products.map(product => {
            const unitPrice = getUnitPrice(product.id, tier);
            const qty = quantityState[product.id];
            const lineTotal = qty * unitPrice;
            return `${product.name}: ${qty} × ${money(unitPrice)} = ${money(lineTotal)}`;
          }),
          '',
          `Subtotal: ${money(subtotal)}`
        ];
        if (vatIncluded) {
          bodyLines.push(`VAT (20%): ${money(vatAmount)}`);
        }
        bodyLines.push(`Estimated total: ${money(total)}`);
        const emailBody = encodeURIComponent(bodyLines.join('\n'));
        emailLink.href = `mailto:?subject=${emailSubject}&body=${emailBody}`;
      }

      function clampValue(value) {
        const numeric = Number(value);
        if (!Number.isFinite(numeric) || numeric < 0) {
          return 0;
        }
        return Math.round(numeric);
      }

      productCards.forEach(card => {
        const productId = card.getAttribute('data-product-id');
        const input = card.querySelector('input[type="number"]');
        const decrement = card.querySelector('.decrement');
        const increment = card.querySelector('.increment');

        const sync = () => {
          quantityState[productId] = clampValue(input.value);
          input.value = quantityState[productId];
          updatePrices();
        };

        decrement.addEventListener('click', () => {
          input.value = clampValue(Number(input.value) - 1);
          sync();
        });

        increment.addEventListener('click', () => {
          input.value = clampValue(Number(input.value) + 1);
          sync();
        });

        input.addEventListener('change', sync);
        input.addEventListener('input', () => {
          // Keep value numeric as user types
          const cleaned = input.value.replace(/[^0-9]/g, '');
          if (cleaned !== input.value) {
            input.value = cleaned;
          }
        });
      });

      vatToggle.addEventListener('change', updatePrices);

      updatePrices();
    })();
  </script>
</div>
